apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: gcpsm-secret-store
  namespace: media-gateway-prod
spec:
  provider:
    gcpsm:
      projectID: "PROJECT_ID"
      auth:
        workloadIdentity:
          clusterLocation: us-central1
          clusterName: media-gateway-cluster
          serviceAccountRef:
            name: media-gateway-sa
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: api-gateway-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: api-gateway-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
  - secretKey: API_KEY
    remoteRef:
      key: media-gateway-api-key
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: discovery-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: discovery-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: sona-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: sona-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
  - secretKey: SONA_API_KEY
    remoteRef:
      key: sona-api-key
  - secretKey: MODEL_REGISTRY_TOKEN
    remoteRef:
      key: model-registry-token
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: sync-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: sync-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
  - secretKey: WEBSOCKET_SECRET
    remoteRef:
      key: websocket-secret
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: auth-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: auth-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
  - secretKey: JWT_PRIVATE_KEY
    remoteRef:
      key: jwt-private-key
  - secretKey: JWT_PUBLIC_KEY
    remoteRef:
      key: jwt-public-key
  - secretKey: OAUTH_CLIENT_ID
    remoteRef:
      key: oauth-client-id
  - secretKey: OAUTH_CLIENT_SECRET
    remoteRef:
      key: oauth-client-secret
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ingestion-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: ingestion-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: media-gateway-database-url
  - secretKey: GCS_BUCKET_NAME
    remoteRef:
      key: gcs-bucket-name
  - secretKey: GCS_SERVICE_ACCOUNT_KEY
    remoteRef:
      key: gcs-service-account-key
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mcp-secrets
  namespace: media-gateway-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: mcp-secrets
    creationPolicy: Owner
  data:
  - secretKey: MCP_API_KEY
    remoteRef:
      key: mcp-api-key
  - secretKey: REDIS_URL
    remoteRef:
      key: media-gateway-redis-url
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: media-gateway-sa
  namespace: media-gateway-prod
  annotations:
    iam.gke.io/gcp-service-account: media-gateway@PROJECT_ID.iam.gserviceaccount.com
